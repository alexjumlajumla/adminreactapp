"use strict";(self.webpackChunkjumlajumla_dashboard=self.webpackChunkjumlajumla_dashboard||[]).push([[651],{23283:(e,l,t)=>{t.d(l,{A:()=>g});var n=t(9950),i=t(3969),a=t(32645),s=t(48538),o=t(87094),d=t(41988),r=t(99674),c=t(91854),u=t(23758),v=t(74623),h=t(70030),m=t(53271),p=t(47992),x=t(80415),j=t(44414);function g(e){var l,t,g,y;let{orderDetails:A,handleCancel:f}=e;const{t:b}=(0,h.B)(),{activeMenu:w}=(0,c.d4)((e=>e.menu),c.bN),[_]=i.A.useForm(),k=(0,c.wA)(),[M,S]=(0,n.useState)(!1),C=x.HF.map((e=>({label:b(e),value:e,key:e})));return(0,j.jsx)(a.A,{visible:!!A,onCancel:f,footer:[(0,j.jsx)(s.A,{type:"primary",onClick:()=>_.submit(),loading:M,children:b("save")},"saveBtn"),(0,j.jsx)(s.A,{type:"default",onClick:f,children:b("cancel")},"cancelBtn")],children:(0,j.jsx)(i.A,{form:_,layout:"vertical",onFinish:e=>{var l,t;const n={deliveryman:null===e||void 0===e||null===(l=e.deliveryman)||void 0===l?void 0:l.value,transaction_status:(null===e||void 0===e||null===(t=e.transaction_status)||void 0===t?void 0:t.value)||(null===e||void 0===e?void 0:e.transaction_status)||void 0};S(!0),u.A.updateDelivery(A.id,n).then((()=>{f(),k((0,v.Ms)(w))})).finally((()=>S(!1)))},initialValues:{deliveryman:null!==A&&void 0!==A&&A.deliveryman?{label:`${(null===A||void 0===A||null===(l=A.deliveryman)||void 0===l?void 0:l.firstname)||""} ${(null===A||void 0===A||null===(t=A.deliveryman)||void 0===t?void 0:t.lastname)||""}`,value:null===A||void 0===A||null===(g=A.deliveryman)||void 0===g?void 0:g.id}:void 0,transaction_status:null===A||void 0===A||null===(y=A.transaction)||void 0===y?void 0:y.status},children:(0,j.jsxs)(o.A,{gutter:12,children:[(0,j.jsx)(d.A,{span:24,children:(0,j.jsx)(i.A.Item,{label:b("deliveryman"),name:"deliveryman",rules:[{required:!0,message:b("required")}],children:(0,j.jsx)(p.G,{className:"w-100",debounceTimeout:500,placeholder:b("select.deliveryman"),fetchOptions:async e=>{var l,t;const n={search:e.length?e:void 0,page:1,perPage:10,role:"deliveryman",shop_id:A.shop.id,exist_token:1,"address[latitude]":(null===A||void 0===A||null===(l=A.location)||void 0===l?void 0:l.latitude)||void 0,"address[longitude]":(null===A||void 0===A||null===(t=A.location)||void 0===t?void 0:t.longitude)||void 0};return m.A.getAll(n).then((e=>{let{data:l}=e;return((null===l||void 0===l?void 0:l.data)||[]).map((e=>({label:e.firstname+" "+e.lastname||"no name",value:e.id})))}))},allowClear:!0})})}),(null===A||void 0===A?void 0:A.transaction)&&(0,j.jsx)(d.A,{span:24,children:(0,j.jsx)(i.A.Item,{label:b("transaction.status"),name:"transaction_status",children:(0,j.jsx)(r.A,{options:C,labelInValue:!0})})})]})})})}},29597:(e,l,t)=>{t.d(l,{A:()=>n});t(63620);function n(e){if(null===e||void 0===e||!e.location)return{lat:47.4143302506288,lng:8.532059477976883};const l=e.location.split(", ");return{lat:Number(null===l||void 0===l?void 0:l[0]),lng:Number(null===l||void 0===l?void 0:l[1])}}},38635:(e,l,t)=>{t.d(l,{A:()=>B});var n=t(12403),i=t(86366),a=t(66362),s=t(32645),o=t(48538),d=t(23263),r=t(87094),c=t(41988),u=t(12916),v=t(9950),h=t(70030),m=t(23758),p=t(81446),x=t(29949),j=t(91854),g=t(63620),y=t(41478),A=t(73631),f=t(29597),b=t(47965),w=t(50327),_=t(25495),k=t(38310),M=t(59051),S=t.n(M),C=t(44414);const{Step:N}=i.A,I=()=>(0,C.jsxs)("div",{style:{position:"relative",textAlign:"center"},children:[(0,C.jsx)("img",{src:y,width:"50",alt:"User Pin"}),(0,C.jsx)("div",{style:{position:"absolute",width:"100px",left:"-25px",bottom:"-20px"},children:(0,C.jsx)(a.A.Text,{strong:!0,children:"Customer"})})]}),F=()=>(0,C.jsxs)("div",{style:{position:"relative",textAlign:"center"},children:[(0,C.jsx)("img",{src:A,width:"50",alt:"Store Pin"}),(0,C.jsx)("div",{style:{position:"absolute",width:"100px",left:"-25px",bottom:"-20px"},children:(0,C.jsx)(a.A.Text,{strong:!0,children:"Shop"})})]}),$=["blue","red","gold","volcano","cyan","lime"],B=e=>{var l,t,a,y,A,M;let{id:B,handleCancel:P}=e;const{t:H}=(0,h.B)(),[q,D]=(0,v.useState)(null),[L,O]=(0,v.useState)(null),[T,V]=(0,v.useState)(null),[G,W]=(0,v.useState)(null),{settings:Y}=(0,j.d4)((e=>e.globalSettings),j.bN),z=(0,f.A)(Y),[U,Z]=(0,v.useState)(0),[E,X]=(0,v.useState)((0,f.A)(Y)),[J,K]=(0,v.useState)((0,f.A)(Y)),[Q,R]=(0,v.useState)([{id:0,name:"new",icon:(0,C.jsx)(b.A,{})},{id:1,name:"accepted",icon:(0,C.jsx)(x.LW,{})},{id:2,name:"ready",icon:(0,C.jsx)(w.NtI,{})},{id:3,name:"on_a_way",icon:(0,C.jsx)(_.o2P,{})},{id:4,name:"delivered",icon:(0,C.jsx)(_.eDZ,{})}]);const{google_map_key:ee}=(0,j.d4)((e=>e.globalSettings.settings),j.bN);(0,v.useEffect)((()=>{D(!0),m.A.getById(B).then((e=>{var l;let{data:t}=e;R("canceled"===t.status?[{id:1,name:"new",icon:(0,C.jsx)(b.A,{})},{id:5,name:"canceled",icon:(0,C.jsx)(k.XfH,{})}]:Q),Z("canceled"===t.status?1:null===(l=Q.find((e=>e.name===t.status)))||void 0===l?void 0:l.id),V("canceled"===t.status?"error":"success"),O(t),K({lat:t.location.latitude,lng:t.location.longitude}),X({lat:t.shop.location.latitude,lng:t.shop.location.longitude})})).finally((()=>{D(!1)}))}),[]);return(0,C.jsx)(C.Fragment,{children:(0,C.jsx)(s.A,{visible:!!B,title:H("show.locations"),onCancel:()=>P(),style:{minWidth:"80vw"},footer:[(0,C.jsx)(o.A,{type:"default",onClick:P,children:H("cancel")},"cancelBtn")],children:q?(0,C.jsx)(p.A,{}):(0,C.jsxs)(d.A,{children:[(0,C.jsx)(i.A,{current:U,status:T,className:"mb-5",children:null===Q||void 0===Q?void 0:Q.map(((e,l)=>(0,C.jsx)(N,{title:H(e.name),icon:null===e||void 0===e?void 0:e.icon},e.id+l)))}),(0,C.jsxs)(r.A,{gutter:12,children:[(0,C.jsxs)(c.A,{span:12,children:[(0,C.jsxs)("h3",{children:[H("order.id")," #",null===L||void 0===L?void 0:L.id]}),(0,C.jsxs)("p",{children:[(0,C.jsx)(x.A5h,{})," ",S()(null===L||void 0===L?void 0:L.created_at).format("YYYY-MM-DD HH:mm")]}),(0,C.jsxs)("p",{children:[H("schedulet.at")," ",null===L||void 0===L?void 0:L.delivery_date]}),(0,C.jsxs)("span",{children:[(0,C.jsx)("strong",{children:null===L||void 0===L||null===(l=L.shop)||void 0===l||null===(t=l.translation)||void 0===t?void 0:t.title})," ",null===L||void 0===L||null===(a=L.details)||void 0===a?void 0:a.map(((e,l)=>{var t,n,i;return(0,C.jsx)(u.A,{color:$[l],children:null===e||void 0===e||null===(t=e.stock)||void 0===t||null===(n=t.product)||void 0===n||null===(i=n.translation)||void 0===i?void 0:i.title})}))]})]}),(0,C.jsxs)(c.A,{span:12,children:[(0,C.jsxs)("p",{children:[H("status")," ","new"===(null===L||void 0===L?void 0:L.status)?(0,C.jsx)(u.A,{color:"blue",children:H(null===L||void 0===L?void 0:L.status)}):"canceled"===(null===L||void 0===L?void 0:L.status)?(0,C.jsx)(u.A,{color:"error",children:H(null===L||void 0===L?void 0:L.status)}):(0,C.jsx)(u.A,{color:"cyan",children:H(null===L||void 0===L?void 0:L.status)})]}),(0,C.jsxs)("p",{children:[H("payment.method")," ",(0,C.jsx)("strong",{children:null===L||void 0===L||null===(y=L.transaction)||void 0===y||null===(A=y.payment_system)||void 0===A?void 0:A.tag})]}),(0,C.jsxs)("p",{children:[H("order.type")," ",(0,C.jsx)("strong",{children:null===L||void 0===L?void 0:L.delivery_type})]}),(0,C.jsxs)("p",{children:[H("payment.type")," ",(0,C.jsx)("strong",{children:null===L||void 0===L||null===(M=L.transaction)||void 0===M?void 0:M.status})]}),G&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)("p",{children:[H("distance")," ",(0,C.jsxs)("strong",{children:[G," km"]})," ",(0,C.jsx)("span",{className:"text-muted",children:H("(direct.between.shop.and.customer)")})]}),(0,C.jsx)("p",{className:"text-muted",style:{fontSize:"12px"},children:(0,C.jsx)("i",{children:"Note: This shows the direct distance as the crow flies, not the actual driving route."})})]})]}),(0,C.jsxs)(c.A,{span:24,className:"mt-5",children:[(0,C.jsx)("h4",{children:H("map")}),(0,C.jsx)("div",{className:"map-container",style:{height:400,width:"100%"},children:(0,C.jsxs)(n.Ay,{bootstrapURLKeys:{key:g.CJ||ee},defaultZoom:15,center:z,yesIWantToUseGoogleMapApiInternals:!0,options:{fullscreenControl:!1},onGoogleApiLoaded:e=>{let{map:l,maps:t}=e;const n={lat:Number(E.lat||"0"),lng:Number(E.lng||"0")},i={lat:Number(J.lat||"0"),lng:Number(J.lng||"0")};if(n.lat&&n.lng&&i.lat&&i.lng){const e=((e,l,t,n)=>{const i=(t-e)*Math.PI/180,a=(n-l)*Math.PI/180,s=Math.sin(i/2)*Math.sin(i/2)+Math.cos(e*Math.PI/180)*Math.cos(t*Math.PI/180)*Math.sin(a/2)*Math.sin(a/2);return(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*6371).toFixed(2)})(n.lat,n.lng,i.lat,i.lng);W(e);new t.Polyline({path:[n,i],geodesic:!0,strokeColor:"#FF5722",strokeOpacity:.8,strokeWeight:2,icons:[{icon:{path:"M 0,-1 0,1",strokeOpacity:1,scale:3},offset:"0",repeat:"15px"}]}).setMap(l)}const a=[n,i];let s=new t.LatLngBounds;for(var o=0;o<a.length;o++)s.extend(a[o]);l.fitBounds(s)},children:[(0,C.jsx)(F,{lat:null===E||void 0===E?void 0:E.lat,lng:null===E||void 0===E?void 0:E.lng}),(0,C.jsx)(I,{lat:null===J||void 0===J?void 0:J.lat,lng:null===J||void 0===J?void 0:J.lng})]})})]})]})]})})})}},41478:(e,l,t)=>{e.exports=t.p+"static/media/user.fbe7078c52acde79652d.jpg"},47992:(e,l,t)=>{t.d(l,{G:()=>r});var n=t(9950),i=t(95491),a=t.n(i),s=t(99674),o=t(90650),d=t(44414);const r=e=>{let{fetchOptions:l,debounceTimeout:t=400,onClear:i,...r}=e;const[c,u]=(0,n.useState)(!1),[v,h]=(0,n.useState)([]),m=(0,n.useMemo)((()=>a()((e=>{h([]),u(!0),l(e).then((e=>{h(e),u(!1)}))}),t)),[l,t]);return(0,d.jsx)(s.A,{showSearch:!0,allowClear:!0,labelInValue:!0,filterOption:!1,onSearch:m,onClear:()=>{m(""),i&&i()},notFoundContent:c?(0,d.jsx)(o.A,{size:"small"}):"no results",...r,options:v,onFocus:()=>{m("")}})}},53774:(e,l,t)=>{t.d(l,{A:()=>i});var n=t(83291);function i(){var e,l;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;const s=null===(e=n.M.getState())||void 0===e||null===(l=e.currency)||void 0===l?void 0:l.defaultCurrency,o=Number(t).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,"),d=i||(null===s||void 0===s?void 0:s.symbol)||"$";return"after"===(a||(null===s||void 0===s?void 0:s.position)||"before")?`${o} ${d}`:`${d} ${o}`}},56592:(e,l,t)=>{t.d(l,{A:()=>j});var n=t(9950),i=t(3969),a=t(32645),s=t(48538),o=t(87094),d=t(41988),r=t(99674),c=t(91854),u=t(70030),v=t(23758),h=t(74623),m=t(80415),p=t(13564),x=t(44414);function j(e){var l;let{orderDetails:t,handleCancel:j,status:g}=e;const{t:y}=(0,u.B)(),A=(0,c.wA)(),f=(0,p.Zp)(),[b]=i.A.useForm(),{activeMenu:w}=(0,c.d4)((e=>e.menu),c.bN),_=(0,c.d4)((e=>e.globalSettings.settings),c.bN),[k,M]=(0,n.useState)(!1),[S,C]=(0,n.useState)(g),N=m.HF.map((e=>({label:y(e),value:e,key:e})));(0,n.useEffect)((()=>{const e=g.findIndex((e=>e.name===t.status));let l=[g[e],g[e+1],{name:"canceled",id:null===g||void 0===g?void 0:g.length,active:!0}];e<0&&(l=[g[e+1],"canceled"]),C(l)}),[t]);return(0,x.jsx)(a.A,{visible:!!t,title:t.title,onCancel:j,footer:[(0,x.jsx)(s.A,{type:"primary",onClick:()=>b.submit(),loading:k,children:y("save")},"save-form"),(0,x.jsx)(s.A,{type:"default",onClick:j,children:y("cancel")},"cansel-modal")],children:(0,x.jsx)(i.A,{form:b,layout:"vertical",onFinish:e=>{var l,n;const i={status:(null===e||void 0===e||null===(l=e.status)||void 0===l?void 0:l.value)||(null===e||void 0===e?void 0:e.status),transaction_status:(null===e||void 0===e||null===(n=e.transaction_status)||void 0===n?void 0:n.value)||(null===e||void 0===e?void 0:e.transaction_status)||void 0};M(!0),v.A.updateStatus(t.id,i).then((e=>{var l,t;"accepted"===(null===e||void 0===e||null===(l=e.data)||void 0===l?void 0:l.status)&&"1"===(null===_||void 0===_?void 0:_.auto_print_order)?(e=>{const l=`orders/generate-invoice/${e}`;A((0,h.X4)({url:l,id:"generate-invoice ",name:y("generate.invoice")})),f(`/${l}?print=true`)})(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.id):(j(),A((0,h.Ms)(w)))})).finally((()=>M(!1)))},initialValues:{status:null===t||void 0===t?void 0:t.status,transaction_status:null===t||void 0===t||null===(l=t.transaction)||void 0===l?void 0:l.status},children:(0,x.jsxs)(o.A,{gutter:12,children:[(0,x.jsx)(d.A,{span:24,children:(0,x.jsx)(i.A.Item,{label:y("status"),name:"status",rules:[{required:!0,message:y("required")}],children:(0,x.jsx)(r.A,{labelInValue:!0,children:null===S||void 0===S?void 0:S.map((e=>(0,x.jsx)(r.A.Option,{value:null===e||void 0===e?void 0:e.name,children:y(null===e||void 0===e?void 0:e.name)},null===e||void 0===e?void 0:e.name)))})})}),(null===t||void 0===t?void 0:t.transaction)&&(0,x.jsx)(d.A,{span:24,children:(0,x.jsx)(i.A.Item,{label:y("transaction.status"),name:"transaction_status",children:(0,x.jsx)(r.A,{options:N})})})]})})})}},73631:(e,l,t)=>{e.exports=t.p+"static/media/shop.46d7a94ca800c711764a.png"},80415:(e,l,t)=>{t.d(l,{Av:()=>c,HF:()=>i,HV:()=>d,LH:()=>n,No:()=>o,Qt:()=>s,fz:()=>r,g$:()=>a});const n={new:[1,2,3,4,5],accepted:[1,2,3,4,5],ready:[1,2,3,4,5],on_a_way:[1,2,3,4,5],delivered:[1,2,3,4,5],canceled:[1,2,3,4,5],cooking:[1,2,3,4,5]},i=["progress","paid","canceled","rejected","refund"],a=["before","after"],s=["blue","red","gold","volcano","cyan","lime"],o=["new","accepted","cooking","ready","ended"],d=["new","accepted","cooking","ready","on_a_way","delivered","canceled"],r=["dine_in","delivery","pickup"],c=["male","female"]}}]);