(self.webpackChunkjumlajumla_dashboard=self.webpackChunkjumlajumla_dashboard||[]).push([[9212],{4159:function(t){t.exports=function(){"use strict";var t=1e3,e=6e4,n=36e5,r="millisecond",i="second",s="minute",a="hour",o="day",u="week",l="month",d="quarter",c="year",h="date",f="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,m=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var e=["th","st","nd","rd"],n=t%100;return"["+t+(e[(n-20)%10]||e[n]||e[0])+"]"}},$=function(t,e,n){var r=String(t);return!r||r.length>=e?t:""+Array(e+1-r.length).join(n)+t},v={s:$,z:function(t){var e=-t.utcOffset(),n=Math.abs(e),r=Math.floor(n/60),i=n%60;return(e<=0?"+":"-")+$(r,2,"0")+":"+$(i,2,"0")},m:function t(e,n){if(e.date()<n.date())return-t(n,e);var r=12*(n.year()-e.year())+(n.month()-e.month()),i=e.clone().add(r,l),s=n-i<0,a=e.clone().add(r+(s?-1:1),l);return+(-(r+(n-i)/(s?i-a:a-i))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:l,y:c,w:u,d:o,D:h,h:a,m:s,s:i,ms:r,Q:d}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},y="en",x={};x[y]=g;var M=function(t){return t instanceof A},S=function t(e,n,r){var i;if(!e)return y;if("string"==typeof e){var s=e.toLowerCase();x[s]&&(i=s),n&&(x[s]=n,i=s);var a=e.split("-");if(!i&&a.length>1)return t(a[0])}else{var o=e.name;x[o]=e,i=o}return!r&&i&&(y=i),i||!r&&y},D=function(t,e){if(M(t))return t.clone();var n="object"==typeof e?e:{};return n.date=t,n.args=arguments,new A(n)},_=v;_.l=S,_.i=M,_.w=function(t,e){return D(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var A=function(){function g(t){this.$L=S(t.locale,null,!0),this.parse(t)}var $=g.prototype;return $.parse=function(t){this.$d=function(t){var e=t.date,n=t.utc;if(null===e)return new Date(NaN);if(_.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var r=e.match(p);if(r){var i=r[2]-1||0,s=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)):new Date(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)}}return new Date(e)}(t),this.$x=t.x||{},this.init()},$.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},$.$utils=function(){return _},$.isValid=function(){return!(this.$d.toString()===f)},$.isSame=function(t,e){var n=D(t);return this.startOf(e)<=n&&n<=this.endOf(e)},$.isAfter=function(t,e){return D(t)<this.startOf(e)},$.isBefore=function(t,e){return this.endOf(e)<D(t)},$.$g=function(t,e,n){return _.u(t)?this[e]:this.set(n,t)},$.unix=function(){return Math.floor(this.valueOf()/1e3)},$.valueOf=function(){return this.$d.getTime()},$.startOf=function(t,e){var n=this,r=!!_.u(e)||e,d=_.p(t),f=function(t,e){var i=_.w(n.$u?Date.UTC(n.$y,e,t):new Date(n.$y,e,t),n);return r?i:i.endOf(o)},p=function(t,e){return _.w(n.toDate()[t].apply(n.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(e)),n)},m=this.$W,g=this.$M,$=this.$D,v="set"+(this.$u?"UTC":"");switch(d){case c:return r?f(1,0):f(31,11);case l:return r?f(1,g):f(0,g+1);case u:var y=this.$locale().weekStart||0,x=(m<y?m+7:m)-y;return f(r?$-x:$+(6-x),g);case o:case h:return p(v+"Hours",0);case a:return p(v+"Minutes",1);case s:return p(v+"Seconds",2);case i:return p(v+"Milliseconds",3);default:return this.clone()}},$.endOf=function(t){return this.startOf(t,!1)},$.$set=function(t,e){var n,u=_.p(t),d="set"+(this.$u?"UTC":""),f=(n={},n[o]=d+"Date",n[h]=d+"Date",n[l]=d+"Month",n[c]=d+"FullYear",n[a]=d+"Hours",n[s]=d+"Minutes",n[i]=d+"Seconds",n[r]=d+"Milliseconds",n)[u],p=u===o?this.$D+(e-this.$W):e;if(u===l||u===c){var m=this.clone().set(h,1);m.$d[f](p),m.init(),this.$d=m.set(h,Math.min(this.$D,m.daysInMonth())).$d}else f&&this.$d[f](p);return this.init(),this},$.set=function(t,e){return this.clone().$set(t,e)},$.get=function(t){return this[_.p(t)]()},$.add=function(r,d){var h,f=this;r=Number(r);var p=_.p(d),m=function(t){var e=D(f);return _.w(e.date(e.date()+Math.round(t*r)),f)};if(p===l)return this.set(l,this.$M+r);if(p===c)return this.set(c,this.$y+r);if(p===o)return m(1);if(p===u)return m(7);var g=(h={},h[s]=e,h[a]=n,h[i]=t,h)[p]||1,$=this.$d.getTime()+r*g;return _.w($,this)},$.subtract=function(t,e){return this.add(-1*t,e)},$.format=function(t){var e=this,n=this.$locale();if(!this.isValid())return n.invalidDate||f;var r=t||"YYYY-MM-DDTHH:mm:ssZ",i=_.z(this),s=this.$H,a=this.$m,o=this.$M,u=n.weekdays,l=n.months,d=function(t,n,i,s){return t&&(t[n]||t(e,r))||i[n].slice(0,s)},c=function(t){return _.s(s%12||12,t,"0")},h=n.meridiem||function(t,e,n){var r=t<12?"AM":"PM";return n?r.toLowerCase():r},p={YY:String(this.$y).slice(-2),YYYY:this.$y,M:o+1,MM:_.s(o+1,2,"0"),MMM:d(n.monthsShort,o,l,3),MMMM:d(l,o),D:this.$D,DD:_.s(this.$D,2,"0"),d:String(this.$W),dd:d(n.weekdaysMin,this.$W,u,2),ddd:d(n.weekdaysShort,this.$W,u,3),dddd:u[this.$W],H:String(s),HH:_.s(s,2,"0"),h:c(1),hh:c(2),a:h(s,a,!0),A:h(s,a,!1),m:String(a),mm:_.s(a,2,"0"),s:String(this.$s),ss:_.s(this.$s,2,"0"),SSS:_.s(this.$ms,3,"0"),Z:i};return r.replace(m,(function(t,e){return e||p[t]||i.replace(":","")}))},$.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},$.diff=function(r,h,f){var p,m=_.p(h),g=D(r),$=(g.utcOffset()-this.utcOffset())*e,v=this-g,y=_.m(this,g);return y=(p={},p[c]=y/12,p[l]=y,p[d]=y/3,p[u]=(v-$)/6048e5,p[o]=(v-$)/864e5,p[a]=v/n,p[s]=v/e,p[i]=v/t,p)[m]||v,f?y:_.a(y)},$.daysInMonth=function(){return this.endOf(l).$D},$.$locale=function(){return x[this.$L]},$.locale=function(t,e){if(!t)return this.$L;var n=this.clone(),r=S(t,e,!0);return r&&(n.$L=r),n},$.clone=function(){return _.w(this.$d,this)},$.toDate=function(){return new Date(this.valueOf())},$.toJSON=function(){return this.isValid()?this.toISOString():null},$.toISOString=function(){return this.$d.toISOString()},$.toString=function(){return this.$d.toUTCString()},g}(),w=A.prototype;return D.prototype=w,[["$ms",r],["$s",i],["$m",s],["$H",a],["$W",o],["$M",l],["$y",c],["$D",h]].forEach((function(t){w[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),D.extend=function(t,e){return t.$i||(t(e,A,D),t.$i=!0),D},D.locale=S,D.isDayjs=M,D.unix=function(t){return D(1e3*t)},D.en=x[y],D.Ls=x,D.p={},D}()},29212:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>M});var r=n(9950),i=n(13564),s=n(92759),a=n(23263),o=n(90650),u=n(48538),l=n(12916),d=n(80737),c=n(91524),h=n(12203),f=n(82371),p=n(12403),m=n(70030),g=n(4159),$=n.n(g),v=n(44414);const y=t=>{let{text:e,color:n="red"}=t;return(0,v.jsx)("div",{style:{background:n,color:"white",borderRadius:"50%",width:"22px",height:"22px",textAlign:"center",lineHeight:"22px",fontWeight:"bold",border:"2px solid white",boxShadow:"0 0 5px rgba(0,0,0,0.3)"},children:e})},x=t=>{let{map:e,maps:n,route:i,color:s}=t;const a=null!==e&&null!==n&&null!==i;return r.useEffect((()=>{if(!a)return;const t=i.map((t=>({lat:parseFloat(t.lat),lng:parseFloat(t.lng)}))),r=new n.Polyline({path:t,geodesic:!0,strokeColor:s,strokeOpacity:.8,strokeWeight:4});return r.setMap(e),()=>{r.setMap(null)}}),[e,n,i,s,a]),null};function M(){var t,e,n;const{id:g}=(0,i.g)(),M=(0,i.Zp)(),{t:S}=(0,m.B)(),[D,_]=(0,r.useState)(null),[A,w]=(0,r.useState)([]),[j,b]=(0,r.useState)(!1),[O,k]=(0,r.useState)(!0),[Y,T]=(0,r.useState)({map:null,maps:null}),C=()=>{b(!0),f.A.get(`dashboard/admin/trips/${g}`).then((t=>{var e;const n=(null===(e=t.data)||void 0===e?void 0:e.data)||{};n.trip?(_(n.trip),w(n.route_lines||[])):s.Ay.error(S("invalid.trip.data"))})).catch((t=>{console.error("Error fetching trip details:",t),s.Ay.error(S("something.went.wrong"))})).finally((()=>b(!1)))};if((0,r.useEffect)((()=>{g&&C()}),[g]),j)return(0,v.jsx)(a.A,{children:(0,v.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"50px"},children:(0,v.jsx)(o.A,{size:"large"})})});if(!D)return(0,v.jsx)(a.A,{children:(0,v.jsxs)("div",{style:{textAlign:"center",padding:"50px"},children:[(0,v.jsx)("p",{children:S("trip.not.found")}),(0,v.jsx)(u.A,{onClick:()=>M("/trips"),children:S("back.to.trips")})]})});const H=[{title:S("seq"),dataIndex:"sequence",key:"sequence"},{title:S("address"),dataIndex:"address",key:"address"},{title:S("status"),dataIndex:"status",key:"status",render:t=>(0,v.jsx)(l.A,{color:{pending:"orange",arrived:"green",skipped:"red"}[t]||"blue",children:t})},{title:S("arrived_at"),dataIndex:"arrived_at",key:"arrived_at",render:t=>t?$()(t).format("YYYY-MM-DD HH:mm"):"-"}],I={lat:parseFloat(D.start_lat),lng:parseFloat(D.start_lng)},E=[];if(D){E.push(I);(D.locations||[]).forEach((t=>{E.push({lat:parseFloat(t.lat),lng:parseFloat(t.lng)})}))}return(0,v.jsxs)(a.A,{title:(0,v.jsxs)(d.A,{children:[(0,v.jsx)(u.A,{onClick:()=>M("/trips"),children:S("back")}),D.name||`#${D.id}`,(0,v.jsx)(u.A,{type:"primary",onClick:()=>{b(!0),f.A.post(`dashboard/admin/trips/${D.id}/optimize`).then((()=>{s.Ay.success(S("optimized.successfully")),C()})).catch((()=>s.Ay.error(S("something.went.wrong")))).finally((()=>b(!1)))},children:S("optimize.trip.again")}),(0,v.jsx)(u.A,{onClick:()=>{k((t=>!t))},children:S(O?"show.original":"show.optimized")})]}),loading:j,children:[(0,v.jsxs)(c.A,{bordered:!0,column:2,size:"small",children:[(0,v.jsx)(c.A.Item,{label:S("driver"),children:(null===(t=D.driver)||void 0===t?void 0:t.firstname)||"-"}),(0,v.jsx)(c.A.Item,{label:S("vehicle"),children:(null===(e=D.vehicle)||void 0===e?void 0:e.model)||"-"}),(0,v.jsx)(c.A.Item,{label:S("status"),children:(0,v.jsx)(l.A,{color:"completed"===D.status?"green":"in_progress"===D.status?"blue":"orange",children:D.status})}),(0,v.jsx)(c.A.Item,{label:S("optimized"),children:null!==(n=D.meta)&&void 0!==n&&n.optimized_at?(0,v.jsx)(l.A,{color:"green",children:$()(D.meta.optimized_at).format("YYYY-MM-DD HH:mm")}):(0,v.jsx)(l.A,{color:"orange",children:S("no")})}),(0,v.jsx)(c.A.Item,{label:S("created_at"),children:$()(D.created_at).format("YYYY-MM-DD HH:mm")}),(0,v.jsx)(c.A.Item,{label:S("stops"),children:D.locations?D.locations.length:0})]}),(0,v.jsxs)("div",{style:{height:"500px",width:"100%",marginTop:16,position:"relative"},children:[(0,v.jsxs)(p.Ay,{bootstrapURLKeys:{key:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_IS_DEMO:"false"}.REACT_APP_GOOGLE_MAPS_KEY},defaultCenter:I,defaultZoom:12,yesIWantToUseGoogleMapApiInternals:!0,onGoogleApiLoaded:t=>{let{map:e,maps:n}=t;return((t,e)=>{T({map:t,maps:e})})(e,n)},children:[(0,v.jsx)(y,{lat:I.lat,lng:I.lng,text:"S",color:"green"}),D.locations&&D.locations.map(((t,e)=>(0,v.jsx)(y,{lat:t.lat,lng:t.lng,text:e+1,color:"arrived"===t.status?"green":"skipped"===t.status?"red":"orange"},t.id)))]}),Y.map&&Y.maps&&(0,v.jsx)(x,{map:Y.map,maps:Y.maps,route:E,color:"#3388ff"})]}),(0,v.jsx)(h.A,{rowKey:"id",columns:H,dataSource:D.locations,pagination:!1,style:{marginTop:24}})]})}}}]);