"use strict";(self.webpackChunkjumlajumla_dashboard=self.webpackChunkjumlajumla_dashboard||[]).push([[2209],{14932:(e,t,a)=>{a.d(t,{A:()=>Y});var s=a(9950),l=a(3969),n=a(80737),i=a(48538),r=a(13564),d=a(87094),o=a(41988),c=a(23263),u=a(55902),m=a(25933),g=a(8724),h=a(40895),x=a(99674),A=a(98591),p=a(53271),j=a(91854),v=a(70030),f=a(62572),y=a(78498),b=a(56713),_=a(63620),q=a(44414);function I(e){let{setLocation:t,form:a,item:s,idx:n,defaultLang:i}=e;const{t:r}=(0,v.B)(),{google_map_key:d}=(0,j.d4)((e=>e.globalSettings.settings),j.bN),{ref:o}=(0,b.usePlacesWidget)({apiKey:d||_.CJ,onPlaceSelected:e=>{const s={lat:null===e||void 0===e?void 0:e.geometry.location.lat(),lng:null===e||void 0===e?void 0:e.geometry.location.lng()};t(s),a.setFieldsValue({[`address[${i}]`]:null===e||void 0===e?void 0:e.formatted_address})}});return(0,q.jsx)(l.A.Item,{label:r("address"),name:`address[${null===s||void 0===s?void 0:s.locale}]`,rules:[{required:(null===s||void 0===s?void 0:s.locale)===i,message:r("required")}],hidden:(null===s||void 0===s?void 0:s.locale)!==i,children:(0,q.jsx)("input",{className:"address-input",ref:o,placeholder:""})},"address"+n)}var k=a(16254),w=a(92019),N=a(12040),S=a(92967),F=a(79406),L=a(58974);const B=e=>{let{logoImage:t,setLogoImage:a,backImage:n,setBackImage:r,form:b,location:_,setLocation:B,user:O}=e;const{t:H}=(0,v.B)(),[M,Y]=(0,s.useState)(null),[$,C]=(0,s.useState)(null),[D,V]=(0,s.useState)(null),{defaultLang:J,languages:P}=(0,j.d4)((e=>e.formLang),j.bN);const T=()=>{Y(!0),V(!0)},E=()=>{C(!0),V(!0)},Q=()=>{Y(!1),C(!1)};return(0,q.jsxs)(d.A,{gutter:12,children:[(0,q.jsx)(o.A,{span:24,children:(0,q.jsx)(c.A,{children:(0,q.jsxs)(d.A,{gutter:12,children:[(0,q.jsx)(o.A,{span:4,children:(0,q.jsx)(l.A.Item,{label:H("logo.image"),children:(0,q.jsx)(k.A,{type:"shops/logo",imageList:t,setImageList:a,form:b,multiple:!1,name:"logo_img"})})}),(0,q.jsx)(o.A,{span:4,children:(0,q.jsx)(l.A.Item,{label:H("background.image"),children:(0,q.jsx)(k.A,{type:"shops/background",imageList:n,setImageList:r,form:b,multiple:!1,name:"background_img"})})}),(0,q.jsx)(o.A,{span:10,children:(0,q.jsx)(l.A.Item,{label:H("status.note"),name:"status_note",children:(0,q.jsx)(A.A,{rows:4})})}),(0,q.jsx)(o.A,{span:4,children:(0,q.jsx)(l.A.Item,{name:"status",label:H("status"),children:(0,q.jsx)(u.A,{disabled:!0})})}),(0,q.jsx)(o.A,{span:2,children:(0,q.jsx)(l.A.Item,{label:H("open"),name:"open",valuePropName:"checked",initialValue:!1,children:(0,q.jsx)(m.A,{})})})]})})}),(0,q.jsx)(o.A,{span:24,children:(0,q.jsx)(c.A,{title:H("general"),children:(0,q.jsxs)(d.A,{gutter:12,children:[(0,q.jsx)(o.A,{span:12,children:(0,q.jsxs)(d.A,{gutter:12,children:[(0,q.jsx)(o.A,{span:24,children:P.map(((e,t)=>(0,q.jsx)(l.A.Item,{label:H("title"),name:`title[${e.locale}]`,rules:[{required:e.locale===J,message:H("required")},{min:2,message:H("title.required")}],hidden:e.locale!==J,children:(0,q.jsx)(u.A,{})},"title"+t)))}),(0,q.jsx)(o.A,{span:24,children:(0,q.jsx)(l.A.Item,{label:H("phone"),name:"phone",rules:[{required:!0,message:H("required")}],children:(0,q.jsx)(g.A,{min:0,className:"w-100"})})})]})}),(0,q.jsx)(o.A,{span:12,children:P.map(((e,t)=>(0,q.jsx)(l.A.Item,{label:H("description"),name:`description[${e.locale}]`,rules:[{required:e.locale===J,message:H("required")},{min:3,message:H("required")}],hidden:e.locale!==J,children:(0,q.jsx)(A.A,{rows:4})},"desc"+t)))}),(0,q.jsx)(o.A,{span:8,children:(0,q.jsx)(l.A.Item,{label:H("restaurant.tags"),name:"tags",rules:[{required:!1,message:H("required")}],children:(0,q.jsx)(F.a,{mode:"multiple",fetchOptions:async function(e){V(!1);const t={search:e};return L.A.getAll(t).then((e=>{let{data:t}=e;return t.map((e=>{var t;return{label:(null===(t=e.translation)||void 0===t?void 0:t.title)||"no name",value:e.id}}))}))},refetch:D})})}),(0,q.jsx)(o.A,{span:8,children:(0,q.jsx)(l.A.Item,{label:H("seller"),name:"user",rules:[{required:!0,message:H("required")}],children:(0,q.jsx)(F.a,{disabled:O,fetchOptions:async function(e){const t={search:e,roles:"user","empty-shop":1};return V(!1),p.A.search(t).then((e=>e.data.map((e=>({label:e.firstname+" "+(e.lastname?e.lastname:""),value:e.id})))))},refetch:D,dropdownRender:e=>(0,q.jsxs)(q.Fragment,{children:[e,(0,q.jsx)(h.A,{style:{margin:"8px 0"}}),(0,q.jsx)(i.A,{className:"w-100",disabled:O,icon:(0,q.jsx)(w.A,{}),onClick:T,children:H("add.user")})]})})})}),(0,q.jsx)(o.A,{span:8,children:(0,q.jsx)(l.A.Item,{label:H("categories"),name:"categories",rules:[{required:!0,message:H("required")}],children:(0,q.jsx)(F.a,{mode:"multiple",fetchOptions:async function(e){const t={search:e,type:"shop"};return V(!1),f.A.getAll(t).then((e=>{let{data:t}=e;return t.map((e=>{var t;return{label:(null===(t=e.translation)||void 0===t?void 0:t.title)||"no name",value:e.id}}))}))},refetch:D,dropdownRender:e=>(0,q.jsxs)(q.Fragment,{children:[e,(0,q.jsx)(h.A,{style:{margin:"8px 0"}}),(0,q.jsx)(i.A,{className:"w-100",icon:(0,q.jsx)(w.A,{}),onClick:E,children:H("add.category")})]})})})})]})})}),(0,q.jsx)(o.A,{span:8,children:(0,q.jsx)(c.A,{title:H("delivery"),children:(0,q.jsxs)(d.A,{gutter:8,children:[(0,q.jsx)(o.A,{span:12,children:(0,q.jsx)(l.A.Item,{name:"price",label:H("min.price"),rules:[{required:!0,message:H("required")}],children:(0,q.jsx)(g.A,{className:"w-100"})})}),(0,q.jsx)(o.A,{span:12,children:(0,q.jsx)(l.A.Item,{name:"price_per_km",label:H("price.per.km"),rules:[{required:!0,message:H("required")}],children:(0,q.jsx)(g.A,{className:"w-100"})})})]})})}),(0,q.jsx)(o.A,{span:8,children:(0,q.jsx)(c.A,{title:H("delivery.time"),children:(0,q.jsxs)(d.A,{gutter:12,children:[(0,q.jsx)(o.A,{span:12,children:(0,q.jsx)(l.A.Item,{name:"delivery_time_type",label:H("delivery_time_type"),rules:[{required:!0,message:H("required")}],children:(0,q.jsxs)(x.A,{className:"w-100",children:[(0,q.jsx)(x.A.Option,{value:"minute",label:H("minutes")}),(0,q.jsx)(x.A.Option,{value:"hour",label:H("hour")})]})})}),(0,q.jsx)(o.A,{span:12,children:(0,q.jsx)(l.A.Item,{name:"delivery_time_from",label:H("delivery_time_from"),rules:[{required:!0,message:H("required")}],children:(0,q.jsx)(g.A,{className:"w-100"})})}),(0,q.jsx)(o.A,{span:12,children:(0,q.jsx)(l.A.Item,{name:"delivery_time_to",label:H("delivery_time_to"),rules:[{required:!0,message:H("required")}],children:(0,q.jsx)(g.A,{className:"w-100"})})})]})})}),(0,q.jsx)(o.A,{span:8,children:(0,q.jsx)(c.A,{title:H("order.info"),children:(0,q.jsxs)(d.A,{gutter:12,children:[(0,q.jsx)(o.A,{span:12,children:(0,q.jsx)(l.A.Item,{label:H("min.amount"),name:"min_amount",rules:[{required:!0,message:H("required")}],children:(0,q.jsx)(g.A,{min:0,className:"w-100"})})}),(0,q.jsx)(o.A,{span:12,children:(0,q.jsx)(l.A.Item,{label:H("tax"),name:"tax",rules:[{required:!0,message:H("required")}],children:(0,q.jsx)(g.A,{min:0,addonAfter:"%",className:"w-100"})})}),(0,q.jsx)(o.A,{span:12,children:(0,q.jsx)(l.A.Item,{label:H("admin.comission"),name:"percentage",rules:[{required:!0,message:H("required")}],children:(0,q.jsx)(g.A,{min:0,className:"w-100",addonAfter:"%"})})})]})})}),(0,q.jsx)(o.A,{span:24,children:(0,q.jsx)(c.A,{title:H("address"),children:(0,q.jsxs)(d.A,{gutter:12,children:[(0,q.jsx)(o.A,{span:12,children:P.map(((e,t)=>(0,q.jsx)(I,{setLocation:B,form:b,item:e,idx:t,defaultLang:J},t)))}),(0,q.jsx)(o.A,{span:24,children:(0,q.jsx)(y.A,{location:_,setLocation:B,setAddress:e=>b.setFieldsValue({[`address[${J}]`]:e})})})]})})}),M&&(0,q.jsx)(N.A,{visible:M,handleCancel:()=>Q()}),$&&(0,q.jsx)(S.A,{visible:$,handleCancel:()=>Q()})]})};var O=a(74623),H=a(58547),M=a(29597);const Y=e=>{var t,a,d,o,c,u,m,g,h;let{next:x,action_type:A="",user:p}=e;const{t:f}=(0,v.B)(),[y]=l.A.useForm(),b=(0,r.Zp)(),_=(0,j.wA)(),{uuid:I}=(0,r.g)(),{activeMenu:k}=(0,j.d4)((e=>e.menu),j.bN),[w,N]=(0,s.useState)(!1),[S,F]=(0,s.useState)(null!==(t=k.data)&&void 0!==t&&t.logo_img?[null===(a=k.data)||void 0===a?void 0:a.logo_img]:[]),[L,Y]=(0,s.useState)(null!==(d=k.data)&&void 0!==d&&d.background_img?[null===(o=k.data)||void 0===o?void 0:o.background_img]:[]),{settings:$}=(0,j.d4)((e=>e.globalSettings),j.bN),[C,D]=(0,s.useState)(null!==k&&void 0!==k&&null!==(c=k.data)&&void 0!==c&&c.location?{lat:parseFloat(null===k||void 0===k||null===(u=k.data)||void 0===u||null===(m=u.location)||void 0===m?void 0:m.latitude),lng:parseFloat(null===k||void 0===k||null===(g=k.data)||void 0===g||null===(h=g.location)||void 0===h?void 0:h.longitude)}:(0,M.A)($));(0,s.useEffect)((()=>()=>{const e=y.getFieldsValue(!0);e.open_time=JSON.stringify(null===e||void 0===e?void 0:e.open_time),e.close_time=JSON.stringify(null===e||void 0===e?void 0:e.close_time),e.open=!!e.open,_((0,O.Ok)({activeMenu:k,data:{...k.data,...e}}))}),[]);return(0,q.jsx)(q.Fragment,{children:(0,q.jsxs)(l.A,{form:y,name:"basic",layout:"vertical",onFinish:e=>{var t,a,s;N(!0);const l={...e,"images[0]":null===(t=S[0])||void 0===t?void 0:t.name,"images[1]":null===(a=L[0])||void 0===a?void 0:a.name,delivery_time_type:e.delivery_time_type,delivery_time_to:e.delivery_time_to,delivery_time_from:e.delivery_time_from,categories:e.categories.map((e=>e.value)),tags:null===e||void 0===e||null===(s=e.tags)||void 0===s?void 0:s.map((e=>e.value)),user_id:e.user.value,open:e.open?1:0,"location[latitude]":C.lat,"location[longitude]":C.lng,user:void 0,delivery_time:0,type:"restaurant"};"edit"===A?function(e,t){H.A.update(I,t).then((()=>{_((0,O.Ok)({activeMenu:k,data:e})),x()})).catch((e=>console.error(e))).finally((()=>N(!1)))}(e,l):function(e,t){H.A.create(t).then((t=>{let{data:a}=t;_((0,O.W6)({id:`restaurant-${a.uuid}`,url:`restaurant/${a.uuid}`,name:f("add.restaurant"),data:{...a,background_img:{name:null===a||void 0===a?void 0:a.background_img},logo_img:{name:null===a||void 0===a?void 0:a.logo_img},...e},refetch:!1})),b(`/restaurant/${a.uuid}?step=1`)})).catch((e=>console.error(e))).finally((()=>N(!1)))}(e,l)},initialValues:{open:!1,status:"new",...k.data},children:[(0,q.jsx)(B,{logoImage:S,setLogoImage:F,backImage:L,setBackImage:Y,form:y,location:C,setLocation:D,user:p}),(0,q.jsx)(n.A,{children:(0,q.jsx)(i.A,{type:"primary",htmlType:"submit",loading:w,children:f("next")})})]})})}},22209:(e,t,a)=>{a.r(t),a.d(t,{default:()=>x,steps:()=>h});var s=a(9950),l=a(91854),n=a(71999),i=a(70030),r=a(86366),d=a(23263),o=a(14932),c=a(90419),u=a(84393),m=a(44414);const{Step:g}=r.A,h=[{title:"restaurant",content:"First-content"},{title:"map",content:"Second-content"},{title:"delivery",content:"Third-content"}],x=()=>{var e;const{t:t}=(0,i.B)(),{activeMenu:a}=(0,l.d4)((e=>e.menu),l.bN),[x,A]=(0,s.useState)((null===(e=a.data)||void 0===e?void 0:e.step)||0),p=()=>{A(x+1)},j=()=>{A(x-1)};return(0,m.jsxs)(d.A,{title:t("add.restaurant"),extra:(0,m.jsx)(n.A,{}),children:[(0,m.jsx)(r.A,{current:x,children:h.map((e=>(0,m.jsx)(g,{title:t(e.title)},e.title)))}),(0,m.jsxs)("div",{className:"steps-content",children:["First-content"===h[x].content&&(0,m.jsx)(o.A,{next:p,user:!1}),"Second-content"===h[x].content&&(0,m.jsx)(u.A,{next:p,prev:j}),"Third-content"===h[x].content&&(0,m.jsx)(c.A,{next:p,prev:j})]})]})}},90419:(e,t,a)=>{a.d(t,{A:()=>h});var s=a(3969),l=a(9950),n=a(81446),i=a(59051),r=a.n(i),d=a(81466),o=a(80127),c=a(13564),u=a(34422),m=a(40691),g=a(44414);const h=e=>{let{next:t,prev:a}=e;const[i]=s.A.useForm(),[h,x]=(0,l.useState)([]),[A,p]=(0,l.useState)(new Array(7).fill(!1)),[j,v]=(0,l.useState)(!1),[f,y]=(0,l.useState)(!1),{uuid:b}=(0,c.g)();return(0,l.useEffect)((()=>{i.setFieldsValue({working_days:u.Q}),b&&(y(!0),o.A.getById(b).then((e=>{x(e.data.closed_dates.filter((e=>e.day>r()(new Date).format("YYYY-MM-DD"))).map((e=>new Date(e.day))))})),d.A.getById(b).then((e=>{p(0!==e.data.dates.length?e.data.dates.map((e=>e.disabled)):[]),0!==e.data.dates.length&&i.setFieldsValue({working_days:e.data.dates.map((e=>({title:e.day,from:r()(e.from,"HH:mm:ss"),to:r()(e.to,"HH:mm:ss"),disabled:Boolean(e.disabled)})))})})).finally((()=>y(!1))))}),[]),(0,g.jsx)(g.Fragment,{children:f?(0,g.jsx)(n.A,{}):(0,g.jsx)(m.A,{onFinish:e=>{v(!0);const a={dates:h?h.map((e=>r()(e).format("YYYY-MM-DD"))):void 0},s={dates:e.working_days.map((e=>({day:e.title,from:r()(e.from?e.from:"00").format("HH-mm"),to:r()(e.to?e.to:"00").format("HH-mm"),disabled:e.disabled})))};o.A.update(b,a).then((()=>{t()})).finally((()=>v(!1))),0!==e.working_days.length&&d.A.update(b,s).then((()=>{t()})).finally((()=>v(!1)))},prev:a,form:i,lines:A,loadingBtn:j,days:h,setDays:x,setLines:p,weeks:u.Q})})}}}]);