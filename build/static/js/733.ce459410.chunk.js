"use strict";(self.webpackChunkjumlajumla_dashboard=self.webpackChunkjumlajumla_dashboard||[]).push([[733],{10733:(e,l,t)=>{t.r(l),t.d(l,{default:()=>f});var n=t(9950),a=t(13564),s=t(12449),i=t(3969),o=t(23263),u=t(91854),d=t(74623),r=t(70030),c=t(59051),v=t.n(c),m=t(58358),h=t(39095),p=t(81446),x=t(25183),b=t(44414);const f=()=>{const{t:e}=(0,r.B)(),{activeMenu:l}=(0,u.d4)((e=>e.menu),u.bN),t=(0,u.wA)(),[c]=i.A.useForm(),f=(0,a.Zp)(),[j,A]=(0,n.useState)(!1),{myShop:g}=(0,u.d4)((e=>e.myShop),u.bN),{id:_}=(0,a.g)();(0,n.useEffect)((()=>()=>{const e=c.getFieldsValue(!0);e.expired_at=JSON.stringify(null===e||void 0===e?void 0:e.expired_at),t((0,d.Ok)({activeMenu:l,data:e}))}),[]);const S=e=>{A(!0),h.A.getById(e).then((e=>{!function(e){var n,a,s,i,o,u,r,m,h;const p={...e,expired_at:v()(e.expired_at,"YYYY-MM-DD"),bonus_stock_id:{label:`${null===e||void 0===e||null===(n=e.bonusStock)||void 0===n||null===(a=n.product)||void 0===a||null===(s=a.translation)||void 0===s?void 0:s.title} ${null!==e&&void 0!==e&&null!==(i=e.bonusStock)&&void 0!==i&&null!==(o=i.extras)&&void 0!==o&&o.length?`=> ${null===e||void 0===e||null===(u=e.bonusStock)||void 0===u||null===(r=u.extras.map((e=>{var l,t;return`${null===e||void 0===e||null===(l=e.group)||void 0===l||null===(t=l.translation)||void 0===t?void 0:t.title}: ${null===e||void 0===e?void 0:e.value}`})))||void 0===r?void 0:r.join(", ")}`:""}`,value:null===e||void 0===e||null===(m=e.bonusStock)||void 0===m?void 0:m.id,key:null===e||void 0===e||null===(h=e.bonusStock)||void 0===h?void 0:h.id}};c.setFieldsValue({...p}),t((0,d.Ok)({activeMenu:l,data:{...p,expired_at:JSON.stringify(p.expired_at)}})),A(!1)}(e.data)})).finally((()=>t((0,d.km)(l))))};(0,n.useEffect)((()=>{l.refetch&&S(_)}),[l.refetch]);return(0,b.jsx)(o.A,{title:e("edit.bonus"),className:"h-100",children:j?(0,b.jsx)(p.A,{}):(0,b.jsx)(x.A,{form:c,handleSubmit:n=>{const a={expired_at:v()(n.expired_at).format("YYYY-MM-DD"),status:n.status,type:"sum",value:n.value,bonus_stock_id:n.bonus_stock_id.value,bonus_quantity:n.bonus_quantity,bonusable_id:g.id},i="seller/bonus/shop";return h.A.update(_,a).then((()=>{s.oR.success(e("successfully.created")),(0,u.vA)((()=>{t((0,d.EK)({...l,nextUrl:i})),t((0,m.S)({}))})),f(`/${i}`)}))}})})}},25183:(e,l,t)=>{t.d(l,{A:()=>f});var n=t(9950),a=t(3969),s=t(87094),i=t(41988),o=t(8724),u=t(87864),d=t(25933),r=t(48538),c=t(59051),v=t.n(c),m=t(70030),h=t(91854),p=t(67231),x=t(80905),b=t(44414);function f(e){let{form:l,handleSubmit:t}=e;const{t:c}=(0,m.B)(),{activeMenu:f}=(0,h.d4)((e=>e.menu),h.bN),[j,A]=(0,n.useState)({bonusStock:!1}),[g,_]=(0,n.useState)(!1);return(0,b.jsxs)(a.A,{name:"bonus-form",layout:"vertical",onFinish:e=>{_(!0),t(e).finally((()=>_(!1)))},form:l,initialValues:{status:!0,...f.data,...(()=>{var e,l;if(null===(e=f.data)||void 0===e||!e.expired_at)return{};const t=JSON.parse(null===(l=f.data)||void 0===l?void 0:l.expired_at);return{expired_at:v()(t,"HH:mm:ss")}})()},className:"d-flex flex-column h-100",children:[(0,b.jsxs)(s.A,{gutter:12,children:[(0,b.jsx)(i.A,{span:12,children:(0,b.jsx)(a.A.Item,{label:c("order_amount"),name:"value",rules:[{required:!0,message:c("required")},{type:"number",min:1,message:c("min.1")}],children:(0,b.jsx)(o.A,{className:"w-100"})})}),(0,b.jsx)(i.A,{span:12,children:(0,b.jsx)(a.A.Item,{label:c("bonus.product.stock"),name:"bonus_stock_id",rules:[{required:!0,message:c("required")}],children:(0,b.jsx)(x.j,{fetchOptions:function(e){let{page:l,search:t}=e;const n={active:1,status:"published",page:l,search:null!==t&&void 0!==t&&t.length?t:void 0};return p.A.getStock(n).then((e=>{var l,t;return A({...j,bonusStock:(null===e||void 0===e||null===(l=e.meta)||void 0===l?void 0:l.current_page)<=(null===e||void 0===e||null===(t=e.meta)||void 0===t?void 0:t.last_page)}),e.data.map((e=>{var l,t,n,a,s;return{label:`${null===e||void 0===e||null===(l=e.product)||void 0===l||null===(t=l.translation)||void 0===t?void 0:t.title} ${null!==e&&void 0!==e&&null!==(n=e.extras)&&void 0!==n&&n.length?` => ${null===e||void 0===e||null===(a=e.extras)||void 0===a||null===(s=a.map((e=>{var l,t;return`${null===e||void 0===e||null===(l=e.group)||void 0===l||null===(t=l.translation)||void 0===t?void 0:t.title}: ${null===e||void 0===e?void 0:e.value}`})))||void 0===s?void 0:s.join(", ")}`:""}`,value:null===e||void 0===e?void 0:e.id,key:null===e||void 0===e?void 0:e.id}}))}))},hasMore:null===j||void 0===j?void 0:j.bonusStock,allowClear:!1})})}),(0,b.jsx)(i.A,{span:12,children:(0,b.jsx)(a.A.Item,{label:c("bonus.product.quantity"),name:"bonus_quantity",rules:[{required:!0,message:c("required")},{type:"number",min:1,message:c("min.1")}],children:(0,b.jsx)(o.A,{className:"w-100"})})}),(0,b.jsx)(i.A,{span:12,children:(0,b.jsx)(a.A.Item,{name:"expired_at",label:c("expired.at"),rules:[{required:!0,message:c("required")}],children:(0,b.jsx)(u.A,{className:"w-100",placeholder:"",disabledDate:e=>v()().add(-1,"days")>=e})})}),(0,b.jsx)(i.A,{span:12,children:(0,b.jsx)(a.A.Item,{label:c("active"),name:"status",valuePropName:"checked",children:(0,b.jsx)(d.A,{})})})]}),(0,b.jsx)("div",{className:"flex-grow-1 d-flex flex-column justify-content-end",children:(0,b.jsx)("div",{className:"pb-5",children:(0,b.jsx)(r.A,{type:"primary",htmlType:"submit",loading:g,children:c("submit")})})})]})}},80905:(e,l,t)=>{t.d(l,{j:()=>d});var n=t(9950),a=t(95491),s=t.n(a),i=t(99674),o=t(90650),u=t(44414);const d=e=>{let{fetchOptions:l,debounceTimeout:t=400,hasMore:a,refetchOnFocus:d=!1,...r}=e;const[c,v]=(0,n.useState)(!1),[m,h]=(0,n.useState)([]),[p,x]=(0,n.useState)(!1),[b,f]=(0,n.useState)(null),[j,A]=(0,n.useState)(1),g=(0,n.useMemo)((()=>s()((e=>{h([]),f(e),v(!0),l({search:e}).then((e=>{h(e),A(2),v(!1)})).finally((()=>x(!1)))}),t)),[l,t,j]);return(0,u.jsxs)(i.A,{showSearch:!0,allowClear:!0,onPopupScroll:async e=>{const t=e.target;p||t.scrollTop+t.offsetHeight!==t.scrollHeight||a&&(x(!0),l({search:b,page:j}).then((e=>{A((e=>e+1)),h([...m,...e])})).finally((()=>x(!1))))},labelInValue:!0,filterOption:!1,onSearch:g,notFoundContent:c?(0,u.jsx)(o.A,{size:"small"}):"no results",onFocus:()=>{d?g(""):null!==m&&void 0!==m&&m.length||g("")},...r,children:[m.map(((e,l)=>(0,u.jsx)(i.A.Option,{value:e.value,children:e.label},l))),p&&(0,u.jsx)(i.A.Option,{children:(0,u.jsx)(o.A,{size:"small"})})]})}}}]);