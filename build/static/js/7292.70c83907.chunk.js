"use strict";(self.webpackChunkjumlajumla_dashboard=self.webpackChunkjumlajumla_dashboard||[]).push([[7292],{7292:(e,t,a)=>{a.r(t),a.d(t,{default:()=>j});var s=a(9950),l=a(13564),n=a(12449),r=a(3969),d=a(23263),i=a(59051),u=a.n(i),o=a(91854),c=a(74623),m=a(35765),p=a(73439),v=a(70030),h=a(62466),f=a(81446),x=a(86954),A=a(44414);function j(){const{t:e}=(0,v.B)(),{activeMenu:t}=(0,o.d4)((e=>e.menu),o.bN),a=(0,o.wA)(),{id:i}=(0,l.g)(),[j]=r.A.useForm(),Y=(0,l.Zp)(),[b,g]=(0,s.useState)(!1);(0,s.useEffect)((()=>()=>{const e=j.getFieldsValue(!0),s=JSON.stringify(e.start),l=JSON.stringify(e.end),n={...e,start:s,end:l};a((0,c.Ok)({activeMenu:t,data:n}))}),[]),(0,s.useEffect)((()=>{t.refetch&&(g(!0),m.A.getById(i).then((e=>{let{data:s}=e;const l={price:null===s||void 0===s?void 0:s.price,type:null===s||void 0===s?void 0:s.type,products:null===s||void 0===s?void 0:s.products.map((e=>{var t;return{label:null===e||void 0===e||null===(t=e.translation)||void 0===t?void 0:t.title,value:null===e||void 0===e?void 0:e.id}})),start:u()(null===s||void 0===s?void 0:s.start,"YYYY-MM-DD"),end:u()(null===s||void 0===s?void 0:s.end,"YYYY-MM-DD"),image:[(0,h.A)(null===s||void 0===s?void 0:s.img)]};j.setFieldsValue(l),a((0,c.Ok)({activeMenu:t,data:{...l,start:null===s||void 0===s?void 0:s.start,end:null===s||void 0===s?void 0:s.end}}))})).finally((()=>{g(!1),a((0,c.km)(t))})))}),[t.refetch]);return(0,A.jsx)(d.A,{title:e("edit.discount"),className:"h-100",children:b?(0,A.jsx)(f.A,{}):(0,A.jsx)(x.A,{form:j,handleSubmit:(s,l)=>{var r;if(u()(s.start).format("YYYY-MM-DD")>u()(s.end).format("YYYY-MM-DD"))return n.oR.error(e("start.date.must.be.before.end.date"));const d={price:s.price,type:s.type,products:s.products.map((e=>e.value)),start:s.start?u()(s.start).format("YYYY-MM-DD"):void 0,end:s.end?u()(s.end).format("YYYY-MM-DD"):void 0,images:[null===(r=l[0])||void 0===r?void 0:r.name]},v="seller/discounts";return m.A.update(i,d).then((()=>{n.oR.success(e("successfully.updated")),(0,o.vA)((()=>{a((0,c.EK)({...t,nextUrl:v})),a((0,p.X)({}))})),Y(`/${v}`)}))}})})}},47992:(e,t,a)=>{a.d(t,{G:()=>u});var s=a(9950),l=a(95491),n=a.n(l),r=a(99674),d=a(90650),i=a(44414);const u=e=>{let{fetchOptions:t,debounceTimeout:a=400,onClear:l,...u}=e;const[o,c]=(0,s.useState)(!1),[m,p]=(0,s.useState)([]),v=(0,s.useMemo)((()=>n()((e=>{p([]),c(!0),t(e).then((e=>{p(e),c(!1)}))}),a)),[t,a]);return(0,i.jsx)(r.A,{showSearch:!0,allowClear:!0,labelInValue:!0,filterOption:!1,onSearch:v,onClear:()=>{v(""),l&&l()},notFoundContent:o?(0,i.jsx)(d.A,{size:"small"}):"no results",...u,options:m,onFocus:()=>{v("")}})}},86954:(e,t,a)=>{a.d(t,{A:()=>j});var s=a(9950),l=a(3969),n=a(87094),r=a(41988),d=a(99674),i=a(8724),u=a(87864),o=a(48538),c=a(59051),m=a.n(c),p=a(47992),v=a(16254),h=a(70030),f=a(91854),x=a(67231),A=a(44414);function j(e){var t,a;let{form:c,handleSubmit:j}=e;const{t:Y}=(0,h.B)(),{activeMenu:b}=(0,f.d4)((e=>e.menu),f.bN),{myShop:g}=(0,f.d4)((e=>e.myShop),f.bN),[y,M]=(0,s.useState)(!1),[D,S]=(0,s.useState)(null!==(t=b.data)&&void 0!==t&&t.image?null===(a=b.data)||void 0===a?void 0:a.image:[]);return(0,A.jsxs)(l.A,{name:"discount-form",layout:"vertical",onFinish:e=>{M(!0),j(e,D).finally((()=>M(!1)))},form:c,initialValues:{...(()=>{var e;const t=b.data;if(null===(e=b.data)||void 0===e||!e.start)return t;const a=b.data.start,s=b.data.end;return{...t,start:m()(a,"YYYY-MM-DD"),end:m()(s,"YYYY-MM-DD")}})()},className:"d-flex flex-column h-100",children:[(0,A.jsxs)(n.A,{gutter:12,children:[(0,A.jsx)(r.A,{span:12,children:(0,A.jsx)(l.A.Item,{label:Y("type"),name:"type",rules:[{required:!0,message:Y("required")}],children:(0,A.jsxs)(d.A,{children:[(0,A.jsx)(d.A.Option,{value:"fix",children:Y("fix")}),(0,A.jsx)(d.A.Option,{value:"percent",children:Y("percent")})]})})}),(0,A.jsx)(r.A,{span:12,children:(0,A.jsx)(l.A.Item,{label:Y("price"),name:"price",rules:[{required:!0,message:Y("required")}],children:(0,A.jsx)(i.A,{min:0,className:"w-100"})})}),(0,A.jsx)(r.A,{span:12,children:(0,A.jsx)(l.A.Item,{label:Y("start.date"),name:"start",rules:[{required:!0,message:Y("required")}],children:(0,A.jsx)(u.A,{className:"w-100",placeholder:"",disabledDate:e=>m()().add(-1,"days")>=e})})}),(0,A.jsx)(r.A,{span:12,children:(0,A.jsx)(l.A.Item,{label:Y("end.date"),name:"end",rules:[{required:!0,message:Y("required")}],children:(0,A.jsx)(u.A,{className:"w-100",placeholder:"",disabledDate:e=>m()().add(-1,"days")>=e})})}),(0,A.jsx)(r.A,{span:24,children:(0,A.jsx)(l.A.Item,{label:Y("products"),name:"products",rules:[{required:!0,message:Y("required")}],children:(0,A.jsx)(p.G,{fetchOptions:async function(e){const t={search:e,shop_id:g.id,status:"published",active:1,rest:1};return x.A.getAll(t).then((e=>{let{data:t}=e;return t.map((e=>{var t;return{label:null===(t=e.translation)||void 0===t?void 0:t.title,value:e.id}}))}))},mode:"multiple"})})}),(0,A.jsx)(r.A,{span:24,children:(0,A.jsx)(l.A.Item,{label:Y("image"),name:"images",rules:[{required:!D.length,message:Y("required")}],children:(0,A.jsx)(v.A,{type:"discounts",imageList:D,setImageList:S,form:c,multiple:!1,name:"image"})})})]}),(0,A.jsx)("div",{className:"flex-grow-1 d-flex flex-column justify-content-end",children:(0,A.jsx)("div",{className:"pb-5",children:(0,A.jsx)(o.A,{type:"primary",htmlType:"submit",loading:y,children:Y("submit")})})})]})}}}]);