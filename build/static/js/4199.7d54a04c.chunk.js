(self.webpackChunkjumlajumla_dashboard=self.webpackChunkjumlajumla_dashboard||[]).push([[4199],{4159:function(t){t.exports=function(){"use strict";var t=1e3,e=6e4,n=36e5,i="millisecond",s="second",r="minute",a="hour",o="day",d="week",l="month",u="quarter",c="year",h="date",m="Invalid Date",f=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,p=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var e=["th","st","nd","rd"],n=t%100;return"["+t+(e[(n-20)%10]||e[n]||e[0])+"]"}},g=function(t,e,n){var i=String(t);return!i||i.length>=e?t:""+Array(e+1-i.length).join(n)+t},x={s:g,z:function(t){var e=-t.utcOffset(),n=Math.abs(e),i=Math.floor(n/60),s=n%60;return(e<=0?"+":"-")+g(i,2,"0")+":"+g(s,2,"0")},m:function t(e,n){if(e.date()<n.date())return-t(n,e);var i=12*(n.year()-e.year())+(n.month()-e.month()),s=e.clone().add(i,l),r=n-s<0,a=e.clone().add(i+(r?-1:1),l);return+(-(i+(n-s)/(r?s-a:a-s))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:l,y:c,w:d,d:o,D:h,h:a,m:r,s:s,ms:i,Q:u}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},v="en",$={};$[v]=y;var A=function(t){return t instanceof w},_=function t(e,n,i){var s;if(!e)return v;if("string"==typeof e){var r=e.toLowerCase();$[r]&&(s=r),n&&($[r]=n,s=r);var a=e.split("-");if(!s&&a.length>1)return t(a[0])}else{var o=e.name;$[o]=e,s=o}return!i&&s&&(v=s),s||!i&&v},j=function(t,e){if(A(t))return t.clone();var n="object"==typeof e?e:{};return n.date=t,n.args=arguments,new w(n)},S=x;S.l=_,S.i=A,S.w=function(t,e){return j(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var w=function(){function y(t){this.$L=_(t.locale,null,!0),this.parse(t)}var g=y.prototype;return g.parse=function(t){this.$d=function(t){var e=t.date,n=t.utc;if(null===e)return new Date(NaN);if(S.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var i=e.match(f);if(i){var s=i[2]-1||0,r=(i[7]||"0").substring(0,3);return n?new Date(Date.UTC(i[1],s,i[3]||1,i[4]||0,i[5]||0,i[6]||0,r)):new Date(i[1],s,i[3]||1,i[4]||0,i[5]||0,i[6]||0,r)}}return new Date(e)}(t),this.$x=t.x||{},this.init()},g.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},g.$utils=function(){return S},g.isValid=function(){return!(this.$d.toString()===m)},g.isSame=function(t,e){var n=j(t);return this.startOf(e)<=n&&n<=this.endOf(e)},g.isAfter=function(t,e){return j(t)<this.startOf(e)},g.isBefore=function(t,e){return this.endOf(e)<j(t)},g.$g=function(t,e,n){return S.u(t)?this[e]:this.set(n,t)},g.unix=function(){return Math.floor(this.valueOf()/1e3)},g.valueOf=function(){return this.$d.getTime()},g.startOf=function(t,e){var n=this,i=!!S.u(e)||e,u=S.p(t),m=function(t,e){var s=S.w(n.$u?Date.UTC(n.$y,e,t):new Date(n.$y,e,t),n);return i?s:s.endOf(o)},f=function(t,e){return S.w(n.toDate()[t].apply(n.toDate("s"),(i?[0,0,0,0]:[23,59,59,999]).slice(e)),n)},p=this.$W,y=this.$M,g=this.$D,x="set"+(this.$u?"UTC":"");switch(u){case c:return i?m(1,0):m(31,11);case l:return i?m(1,y):m(0,y+1);case d:var v=this.$locale().weekStart||0,$=(p<v?p+7:p)-v;return m(i?g-$:g+(6-$),y);case o:case h:return f(x+"Hours",0);case a:return f(x+"Minutes",1);case r:return f(x+"Seconds",2);case s:return f(x+"Milliseconds",3);default:return this.clone()}},g.endOf=function(t){return this.startOf(t,!1)},g.$set=function(t,e){var n,d=S.p(t),u="set"+(this.$u?"UTC":""),m=(n={},n[o]=u+"Date",n[h]=u+"Date",n[l]=u+"Month",n[c]=u+"FullYear",n[a]=u+"Hours",n[r]=u+"Minutes",n[s]=u+"Seconds",n[i]=u+"Milliseconds",n)[d],f=d===o?this.$D+(e-this.$W):e;if(d===l||d===c){var p=this.clone().set(h,1);p.$d[m](f),p.init(),this.$d=p.set(h,Math.min(this.$D,p.daysInMonth())).$d}else m&&this.$d[m](f);return this.init(),this},g.set=function(t,e){return this.clone().$set(t,e)},g.get=function(t){return this[S.p(t)]()},g.add=function(i,u){var h,m=this;i=Number(i);var f=S.p(u),p=function(t){var e=j(m);return S.w(e.date(e.date()+Math.round(t*i)),m)};if(f===l)return this.set(l,this.$M+i);if(f===c)return this.set(c,this.$y+i);if(f===o)return p(1);if(f===d)return p(7);var y=(h={},h[r]=e,h[a]=n,h[s]=t,h)[f]||1,g=this.$d.getTime()+i*y;return S.w(g,this)},g.subtract=function(t,e){return this.add(-1*t,e)},g.format=function(t){var e=this,n=this.$locale();if(!this.isValid())return n.invalidDate||m;var i=t||"YYYY-MM-DDTHH:mm:ssZ",s=S.z(this),r=this.$H,a=this.$m,o=this.$M,d=n.weekdays,l=n.months,u=function(t,n,s,r){return t&&(t[n]||t(e,i))||s[n].slice(0,r)},c=function(t){return S.s(r%12||12,t,"0")},h=n.meridiem||function(t,e,n){var i=t<12?"AM":"PM";return n?i.toLowerCase():i},f={YY:String(this.$y).slice(-2),YYYY:this.$y,M:o+1,MM:S.s(o+1,2,"0"),MMM:u(n.monthsShort,o,l,3),MMMM:u(l,o),D:this.$D,DD:S.s(this.$D,2,"0"),d:String(this.$W),dd:u(n.weekdaysMin,this.$W,d,2),ddd:u(n.weekdaysShort,this.$W,d,3),dddd:d[this.$W],H:String(r),HH:S.s(r,2,"0"),h:c(1),hh:c(2),a:h(r,a,!0),A:h(r,a,!1),m:String(a),mm:S.s(a,2,"0"),s:String(this.$s),ss:S.s(this.$s,2,"0"),SSS:S.s(this.$ms,3,"0"),Z:s};return i.replace(p,(function(t,e){return e||f[t]||s.replace(":","")}))},g.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},g.diff=function(i,h,m){var f,p=S.p(h),y=j(i),g=(y.utcOffset()-this.utcOffset())*e,x=this-y,v=S.m(this,y);return v=(f={},f[c]=v/12,f[l]=v,f[u]=v/3,f[d]=(x-g)/6048e5,f[o]=(x-g)/864e5,f[a]=x/n,f[r]=x/e,f[s]=x/t,f)[p]||x,m?v:S.a(v)},g.daysInMonth=function(){return this.endOf(l).$D},g.$locale=function(){return $[this.$L]},g.locale=function(t,e){if(!t)return this.$L;var n=this.clone(),i=_(t,e,!0);return i&&(n.$L=i),n},g.clone=function(){return S.w(this.$d,this)},g.toDate=function(){return new Date(this.valueOf())},g.toJSON=function(){return this.isValid()?this.toISOString():null},g.toISOString=function(){return this.$d.toISOString()},g.toString=function(){return this.$d.toUTCString()},y}(),M=w.prototype;return j.prototype=M,[["$ms",i],["$s",s],["$m",r],["$H",a],["$W",o],["$M",l],["$y",c],["$D",h]].forEach((function(t){M[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),j.extend=function(t,e){return t.$i||(t(e,w,j),t.$i=!0),j},j.locale=_,j.isDayjs=A,j.unix=function(t){return j(1e3*t)},j.en=$[v],j.Ls=$,j.p={},j}()},4199:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>M});var i=n(9950),s=n(3969),r=n(92759),a=n(12916),o=n(80737),d=n(48538),l=n(23263),u=n(99674),c=n(87864),h=n(12203),m=n(32645),f=n(55902),p=n(8724),y=n(82371),g=n(70030),x=n(4159),v=n.n(x),$=n(13564),A=n(26689),_=n(44414);function j(){const{t:t}=(0,g.B)(),[e,n]=(0,i.useState)([]),[s,a]=(0,i.useState)(!1);(0,i.useEffect)((()=>{o()}),[]);const o=()=>{a(!0),y.A.get("dashboard/admin/trips/optimization-logs").then((t=>{n(t.data)})).catch((()=>r.Ay.error(t("something.went.wrong")))).finally((()=>a(!1)))},u=[{title:t("time.taken"),dataIndex:"time_taken",key:"time_taken"},{title:t("strategy.used"),dataIndex:"strategy",key:"strategy"},{title:t("confidence.score"),dataIndex:"confidence_score",key:"confidence_score"},{title:t("previous.route"),dataIndex:"previous_route",key:"previous_route"},{title:t("optimized.route"),dataIndex:"optimized_route",key:"optimized_route"}],c=t=>{console.log(`Downloading logs as ${t}`)};return(0,_.jsxs)(l.A,{title:t("optimization.analytics"),loading:s,children:[(0,_.jsx)(d.A,{onClick:()=>c("csv"),children:t("download.csv")}),(0,_.jsx)(d.A,{onClick:()=>c("pdf"),children:t("download.pdf")}),(0,_.jsx)(h.A,{rowKey:"id",columns:u,dataSource:e,pagination:!1,style:{marginTop:16}})]})}var S=n(25933);function w(){const{t:t}=(0,g.B)(),[e,n]=(0,i.useState)(!0),[s,a]=(0,i.useState)({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_IS_DEMO:"false"}.REACT_APP_OPENAI_API_KEY||"");return(0,_.jsxs)(l.A,{title:t("settings.panel"),children:[(0,_.jsxs)("div",{style:{marginBottom:16},children:[(0,_.jsx)("span",{children:t("ai.optimization")}),(0,_.jsx)(S.A,{checked:e,onChange:e=>{n(e),r.Ay.success(t("settings.updated"))},style:{marginLeft:8}})]}),(0,_.jsxs)("div",{style:{marginBottom:16},children:[(0,_.jsx)("span",{children:t("api.key")}),(0,_.jsx)(f.A,{value:s,onChange:t=>{a(t.target.value)},style:{width:"60%",marginLeft:8}})]}),(0,_.jsx)(d.A,{type:"primary",onClick:()=>{r.Ay.info(t("testing.endpoint"))},children:t("test.endpoint")})]})}function M(){const{t:t}=(0,g.B)(),[e,n]=(0,i.useState)([]),[x,S]=(0,i.useState)(!1),[M,D]=(0,i.useState)(!1),[k]=s.A.useForm(),[O,b]=(0,i.useState)({status:"",date:null,optimized:""}),[C,z]=(0,i.useState)([]),I=(0,$.Zp)(),T=()=>{S(!0),y.A.get("dashboard/admin/trips").then((t=>{var e,i,s;const r=(null===(e=t.data)||void 0===e||null===(i=e.data)||void 0===i?void 0:i.data)||(null===(s=t.data)||void 0===s?void 0:s.data)||[];n(r)})).catch((()=>r.Ay.error(t("something.went.wrong")))).finally((()=>S(!1)))};(0,i.useEffect)((()=>{T()}),[]);const Y=e=>{S(!0),y.A.post(`dashboard/admin/trips/${e.id}/optimize`).then((()=>{r.Ay.success(t("optimized.successfully")),T()})).catch((()=>r.Ay.error(t("something.went.wrong")))).finally((()=>S(!1)))},E=(t,e)=>{b((n=>({...n,[t]:e})))},H=e.filter((t=>{var e,n;const i=!O.status||t.status===O.status,s=!O.date||v()(t.scheduled_at).isSame(O.date,"day"),r=!O.optimized||("optimized"===O.optimized?null===(e=t.meta)||void 0===e?void 0:e.optimized_at:!(null!==(n=t.meta)&&void 0!==n&&n.optimized_at));return i&&s&&r})),L=[{title:t("name"),dataIndex:"name",key:"name",render:(t,e)=>(0,_.jsx)(A.N_,{to:`/trips/${e.id}`,children:t||`#${e.id}`})},{title:t("start.address"),dataIndex:"start_address",key:"start_address"},{title:t("scheduled.at"),dataIndex:"scheduled_at",key:"scheduled_at",render:t=>t?v()(t).format("YYYY-MM-DD HH:mm"):"-"},{title:t("status"),dataIndex:"status",key:"status"},{title:t("stops"),key:"stops",render:(t,e)=>{var n;return(null===(n=e.locations)||void 0===n?void 0:n.length)||0}},{title:t("optimized"),dataIndex:"meta",key:"optimized",render:e=>null!==e&&void 0!==e&&e.optimized_at?(0,_.jsx)(a.A,{color:"green",children:t("optimized")}):null!==e&&void 0!==e&&e.optimization_failure_reason?(0,_.jsx)(a.A,{color:"red",children:t("failed")}):(0,_.jsx)(a.A,{color:"orange",children:t("pending")})},{title:t("actions"),key:"actions",render:(e,n)=>{var i;return(0,_.jsx)(o.A,{children:(0,_.jsx)(d.A,{size:"small",type:"primary",disabled:!(null===(i=n.meta)||void 0===i||!i.optimized_at),onClick:()=>Y(n),children:t("optimize")})})}}],W={selectedRowKeys:C,onChange:t=>{z(t)}};return(0,_.jsxs)(l.A,{title:t("trips"),extra:(0,_.jsx)(d.A,{type:"primary",onClick:()=>D(!0),children:t("create")}),children:[(0,_.jsxs)(o.A,{direction:"vertical",style:{width:"100%"},children:[(0,_.jsxs)(o.A,{style:{marginBottom:16},children:[(0,_.jsxs)(u.A,{placeholder:t("status"),onChange:t=>E("status",t),children:[(0,_.jsx)(u.A.Option,{value:"",children:t("all")}),(0,_.jsx)(u.A.Option,{value:"pending",children:t("pending")}),(0,_.jsx)(u.A.Option,{value:"completed",children:t("completed")})]}),(0,_.jsx)(c.A,{onChange:t=>E("date",t)}),(0,_.jsxs)(u.A,{placeholder:t("optimized"),onChange:t=>E("optimized",t),children:[(0,_.jsx)(u.A.Option,{value:"",children:t("all")}),(0,_.jsx)(u.A.Option,{value:"optimized",children:t("optimized")}),(0,_.jsx)(u.A.Option,{value:"not_optimized",children:t("not_optimized")})]})]}),(0,_.jsxs)(o.A,{style:{marginBottom:16},children:[(0,_.jsx)(d.A,{onClick:()=>{C.forEach((t=>{Y({id:t})}))},disabled:!C.length,children:t("optimize.selected")}),(0,_.jsx)(d.A,{onClick:()=>{console.log("Exporting trips:",C)},disabled:!C.length,children:t("export")}),(0,_.jsx)(d.A,{type:"primary",icon:(0,_.jsx)("span",{role:"img","aria-label":"map",children:"\ud83d\uddfa\ufe0f"}),onClick:()=>I("/trips/tracking"),children:t("live.tracking")})]}),(0,_.jsx)(h.A,{rowKey:"id",loading:x,columns:L,dataSource:H,rowSelection:W}),(0,_.jsx)(j,{}),(0,_.jsx)(w,{})]}),(0,_.jsx)(m.A,{title:t("create.trip"),open:M,onOk:()=>{k.validateFields().then((e=>{var n,i;const s={name:e.name,start_address:e.start_address,start_lat:e.start_lat,start_lng:e.start_lng,scheduled_at:null===(n=e.scheduled_at)||void 0===n?void 0:n.toISOString(),locations:(null===(i=e.locations)||void 0===i?void 0:i.map((t=>({address:t.address,lat:t.lat,lng:t.lng}))))||[]};y.A.post("dashboard/admin/trips",s).then((()=>{r.Ay.success(t("created.successfully")),D(!1),k.resetFields(),T()})).catch((()=>r.Ay.error(t("something.went.wrong"))))})).catch((()=>{}))},onCancel:()=>D(!1),okText:t("create"),width:800,children:(0,_.jsxs)(s.A,{layout:"vertical",form:k,children:[(0,_.jsx)(s.A.Item,{name:"name",label:t("name"),children:(0,_.jsx)(f.A,{maxLength:255})}),(0,_.jsx)(s.A.Item,{name:"start_address",label:t("start.address"),rules:[{required:!0}],children:(0,_.jsx)(f.A,{})}),(0,_.jsxs)(o.A,{style:{display:"flex",marginBottom:16},align:"start",children:[(0,_.jsx)(s.A.Item,{name:"start_lat",label:t("start.lat"),rules:[{required:!0,type:"number"}],children:(0,_.jsx)(p.A,{style:{width:150},placeholder:"-6.7924"})}),(0,_.jsx)(s.A.Item,{name:"start_lng",label:t("start.lng"),rules:[{required:!0,type:"number"}],children:(0,_.jsx)(p.A,{style:{width:150},placeholder:"39.2083"})}),(0,_.jsx)(s.A.Item,{name:"scheduled_at",label:t("scheduled.at"),children:(0,_.jsx)(c.A,{showTime:!0})})]}),(0,_.jsx)(s.A.List,{name:"locations",initialValue:[{}],children:(e,n)=>{let{add:i,remove:r}=n;return(0,_.jsxs)(_.Fragment,{children:[e.map((e=>{let{key:n,name:i,...a}=e;return(0,_.jsxs)(o.A,{align:"baseline",style:{display:"flex",marginBottom:8},children:[(0,_.jsx)(s.A.Item,{...a,name:[i,"address"],label:t("stop.address"),rules:[{required:!0}],children:(0,_.jsx)(f.A,{placeholder:t("address")})}),(0,_.jsx)(s.A.Item,{...a,name:[i,"lat"],label:"Lat",rules:[{required:!0,type:"number"}],children:(0,_.jsx)(p.A,{style:{width:120}})}),(0,_.jsx)(s.A.Item,{...a,name:[i,"lng"],label:"Lng",rules:[{required:!0,type:"number"}],children:(0,_.jsx)(p.A,{style:{width:120}})}),(0,_.jsx)(d.A,{danger:!0,onClick:()=>r(i),children:t("remove")})]},n)})),(0,_.jsx)(d.A,{type:"dashed",onClick:()=>i(),style:{width:"100%"},children:t("add.stop")})]})}})]})})]})}}}]);