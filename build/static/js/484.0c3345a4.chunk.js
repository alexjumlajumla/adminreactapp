"use strict";(self.webpackChunkjumlajumla_dashboard=self.webpackChunkjumlajumla_dashboard||[]).push([[484],{484:(e,t,a)=>{a.r(t),a.d(t,{default:()=>$});var s=a(9950),r=a(87864),l=a(99674),i=a(66362),n=a(54909),o=a(92759),d=a(48538),c=a(99985),u=a(90650),p=a(12916),m=a(80737),h=a(23263),x=a(87094),y=a(41988),v=a(3969),g=a(12203),j=a(32645),f=a(63611),A=a(40895),b=a(67376),_=a(12678),w=a(37866),C=a(9251),S=a(82371);var I=a(59051),k=a.n(I),N=a(44414);const{RangePicker:z}=r.A,{Option:T}=l.A,{Title:D,Text:E,Paragraph:F}=i.A,{TabPane:R}=n.A,Y=e=>{let{data:t}=e;const a=JSON.stringify(t,null,2);return(0,N.jsxs)("div",{children:[(0,N.jsx)("div",{style:{marginBottom:"10px",display:"flex",justifyContent:"flex-end"},children:(0,N.jsx)(d.A,{type:"primary",size:"small",icon:(0,N.jsx)(b.A,{}),onClick:()=>{navigator.clipboard.writeText(a).then((()=>{o.Ay.success("Copied to clipboard!")})).catch((e=>{console.error("Failed to copy:",e),o.Ay.error("Failed to copy: "+e.message)}))},children:"Copy"})}),(0,N.jsx)("pre",{style:{maxHeight:"500px",overflowY:"auto",backgroundColor:"#f6f8fa",padding:"12px",borderRadius:"4px",border:"1px solid #e1e4e8",fontSize:"14px"},children:a})]})},M=e=>{let{data:t}=e;const[r,l]=(0,s.useState)(!1),[i,n]=(0,s.useState)(null),[o,d]=(0,s.useState)(null);return(0,s.useEffect)((()=>{(async()=>{try{const e=await a.e(8795).then(a.t.bind(a,8795,23)).catch((()=>{throw new Error("react-json-view package is not installed")}));if(!e||!e.default)throw new Error("Invalid react-json-view module");n((()=>e.default)),l(!0)}catch(e){console.error("Error loading react-json-view:",e),d(e.message)}})()}),[]),o?(0,N.jsxs)("div",{children:[(0,N.jsx)(c.A,{message:"Using fallback JSON viewer",description:"Enhanced text-based JSON viewer is being used because the graphical component couldn't be loaded.",type:"info",showIcon:!0,style:{marginBottom:10}}),(0,N.jsx)(Y,{data:t})]}):r?t?(0,N.jsx)(i,{src:t,name:null,theme:"rjv-default",displayDataTypes:!1,enableClipboard:!0,collapsed:1}):(0,N.jsx)(c.A,{message:"No data available",type:"info"}):(0,N.jsx)(u.A,{tip:"Loading JSON viewer..."})},$=()=>{const[e,t]=(0,s.useState)([]),[a,r]=(0,s.useState)(!0),[i,I]=(0,s.useState)(!1),[E,Y]=(0,s.useState)(null),[$,q]=(0,s.useState)(!1),[L,U]=(0,s.useState)(null),[O,B]=(0,s.useState)({current:1,pageSize:15,total:0}),[P,H]=(0,s.useState)({request_type:"",successful:"",date_from:"",date_to:""}),V=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;r(!0),U(null);try{const a={page:e,per_page:O.pageSize,...P},s=await S.A.get("/api/v1/dashboard/admin/ai-assistant/logs",{params:a});s.data&&s.data.data?(t(s.data.data||[]),B({current:s.data.current_page||1,pageSize:s.data.per_page||15,total:s.data.total||0})):(t([]),console.error("Invalid response format:",s.data),U("Received invalid data format from the server"))}catch(L){var a,s;console.error("Error fetching AI assistant logs:",L),U("Failed to fetch logs: "+((null===(a=L.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||L.message)),t([])}finally{r(!1)}};(0,s.useEffect)((()=>{V()}),[]);const J=(e,t)=>{H({...P,[e]:t})},G=()=>{V(O.current)},K=e=>{if(!e)return"";try{return k()(e).format("YYYY-MM-DD HH:mm:ss")}catch(L){return console.error("Error formatting date:",L),e||""}},Q=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return e?e.length>t?`${e.substring(0,t)}...`:e:""},W=e=>{if(e)try{navigator.clipboard.writeText(e).then((()=>{o.Ay.success("Copied to clipboard!")})).catch((e=>{console.error("Failed to copy:",e),o.Ay.error("Failed to copy: "+e.message)}))}catch(t){const a=document.createElement("textarea");a.value=e,document.body.appendChild(a),a.focus(),a.select();try{document.execCommand("copy")?o.Ay.success("Copied to clipboard!"):o.Ay.error("Failed to copy")}catch(t){o.Ay.error("Failed to copy: "+t.message)}document.body.removeChild(a)}else o.Ay.warning("Nothing to copy!")},X=[{title:"ID",dataIndex:"id",key:"id",width:60},{title:"User",dataIndex:"user",key:"user",render:e=>{if(!e)return"Guest";try{return`${e.firstname||e.name||""} ${e.lastname||""}`.trim()||"User #"+e.id}catch(L){return console.error("Error rendering user:",L),"Error"}}},{title:"Type",dataIndex:"request_type",key:"request_type",render:e=>{if(!e)return(0,N.jsx)(p.A,{children:"Unknown"});let t="default";return"voice_order"===e?t="blue":"realtime_transcription"===e?t="purple":"repeat_order"===e?t="cyan":"text"===e&&(t="green"),(0,N.jsx)(p.A,{color:t,children:e})}},{title:"Input",dataIndex:"input",key:"input",render:e=>(0,N.jsx)("span",{title:e,children:Q(e)})},{title:"Output",dataIndex:"output",key:"output",render:e=>(0,N.jsx)("span",{title:e,children:Q(e)})},{title:"Status",dataIndex:"successful",key:"successful",render:e=>(0,N.jsx)(p.A,{color:e?"success":"error",children:e?"Success":"Failed"})},{title:"Processing Time",dataIndex:"processing_time_ms",key:"processing_time_ms",render:e=>`${e||0}ms`},{title:"Date",dataIndex:"created_at",key:"created_at",render:e=>K(e)},{title:"Actions",key:"actions",render:(e,t)=>(0,N.jsx)(m.A,{children:(0,N.jsx)(d.A,{type:"primary",icon:(0,N.jsx)(_.A,{}),size:"small",onClick:()=>(async e=>{Y({...e}),I(!0),q(!0);try{const a=await S.A.get(`/api/v1/voice-order/log/${e.id}`);var t;a.data&&a.data.success&&a.data.log?Y({...e,...a.data.log,debug_info:a.data.debug_info||{}}):o.Ay.error("Could not load log details: "+((null===(t=a.data)||void 0===t?void 0:t.message)||"Unknown error"))}catch(L){var a,s;console.error("Error fetching log details:",L),o.Ay.error("Error loading log details: "+((null===(a=L.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||L.message))}finally{q(!1)}})(t),children:"View"})})}];return(0,N.jsxs)("div",{children:[(0,N.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[(0,N.jsx)("h2",{className:"mb-4",children:"AI Assistant Logs"}),(0,N.jsx)(d.A,{type:"primary",icon:(0,N.jsx)(w.A,{}),onClick:G,loading:a,children:"Refresh"})]}),L&&(0,N.jsx)(c.A,{message:"Error",description:L,type:"error",showIcon:!0,style:{marginBottom:16},action:(0,N.jsx)(d.A,{size:"small",type:"primary",onClick:G,children:"Try Again"})}),(0,N.jsxs)(h.A,{className:"mb-4",children:[(0,N.jsxs)(x.A,{gutter:[24,16],children:[(0,N.jsx)(y.A,{md:6,sm:12,children:(0,N.jsx)(v.A.Item,{label:"Request Type",children:(0,N.jsxs)(l.A,{placeholder:"All Types",value:P.request_type||void 0,onChange:e=>J("request_type",e),allowClear:!0,style:{width:"100%"},children:[(0,N.jsx)(T,{value:"voice_order",children:"Voice Order"}),(0,N.jsx)(T,{value:"realtime_transcription",children:"Realtime Transcription"}),(0,N.jsx)(T,{value:"repeat_order",children:"Repeat Order"}),(0,N.jsx)(T,{value:"text",children:"Text Chat"})]})})}),(0,N.jsx)(y.A,{md:6,sm:12,children:(0,N.jsx)(v.A.Item,{label:"Status",children:(0,N.jsxs)(l.A,{placeholder:"All Status",value:P.successful||void 0,onChange:e=>J("successful",e),allowClear:!0,style:{width:"100%"},children:[(0,N.jsx)(T,{value:"1",children:"Successful"}),(0,N.jsx)(T,{value:"0",children:"Failed"})]})})}),(0,N.jsx)(y.A,{md:12,sm:24,children:(0,N.jsx)(v.A.Item,{label:"Date Range",children:(0,N.jsx)(z,{style:{width:"100%"},onChange:e=>{e&&2===e.length?H({...P,date_from:e[0].format("YYYY-MM-DD"),date_to:e[1].format("YYYY-MM-DD")}):H({...P,date_from:"",date_to:""})},value:P.date_from&&P.date_to?[k()(P.date_from),k()(P.date_to)]:null})})})]}),(0,N.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,N.jsx)(d.A,{style:{marginRight:8},onClick:()=>{H({request_type:"",successful:"",date_from:"",date_to:""}),V(1)},icon:(0,N.jsx)(w.A,{}),children:"Reset"}),(0,N.jsx)(d.A,{type:"primary",onClick:()=>{V(1)},icon:(0,N.jsx)(C.A,{}),children:"Apply Filters"})]})]}),(0,N.jsx)(h.A,{children:(0,N.jsx)(g.A,{columns:X,dataSource:e,rowKey:"id",loading:a,pagination:{current:O.current,pageSize:O.pageSize,total:O.total,onChange:e=>{V(e)},showSizeChanger:!1},locale:{emptyText:L?"Error loading data":"No data available"}})}),(0,N.jsx)(j.A,{title:`AI Assistant Log #${(null===E||void 0===E?void 0:E.id)||""}`,visible:i,onCancel:()=>I(!1),width:800,footer:[(0,N.jsx)(d.A,{onClick:()=>I(!1),children:"Close"},"close")],children:$?(0,N.jsxs)("div",{style:{textAlign:"center",padding:"20px"},children:[(0,N.jsx)(u.A,{size:"large"}),(0,N.jsx)("p",{children:"Loading log details..."})]}):E?(0,N.jsxs)(n.A,{defaultActiveKey:"1",children:[(0,N.jsx)(R,{tab:"Basic Info",children:(0,N.jsx)(f.Ay,{itemLayout:"horizontal",dataSource:[{label:"Request Type",value:(0,N.jsx)(p.A,{color:"voice_order"===(null===E||void 0===E?void 0:E.request_type)?"blue":"purple",children:(null===E||void 0===E?void 0:E.request_type)||"Unknown"})},{label:"User",value:null!==E&&void 0!==E&&E.user?`${E.user.firstname||E.user.name||""} ${E.user.lastname||""} (ID: ${E.user.id||"Unknown"})`:"Guest"},{label:"Status",value:(0,N.jsx)(p.A,{color:null!==E&&void 0!==E&&E.successful?"success":"error",children:null!==E&&void 0!==E&&E.successful?"Success":"Failed"})},{label:"Date",value:null!==E&&void 0!==E&&E.created_at?K(E.created_at):"N/A"},{label:"Processing Time",value:`${(null===E||void 0===E?void 0:E.processing_time_ms)||0}ms`},{label:"Session ID",value:(null===E||void 0===E?void 0:E.session_id)||"N/A"}],renderItem:e=>(0,N.jsx)(f.Ay.Item,{children:(0,N.jsx)(f.Ay.Item.Meta,{title:e.label,description:e.value})})})},"1"),(0,N.jsx)(R,{tab:"Transcription",children:(0,N.jsxs)(h.A,{children:[(0,N.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:[(0,N.jsx)(D,{level:5,children:"User Input"}),(0,N.jsx)(d.A,{icon:(0,N.jsx)(b.A,{}),onClick:()=>W(null===E||void 0===E?void 0:E.input),size:"small",disabled:!(null!==E&&void 0!==E&&E.input),children:"Copy"})]}),(0,N.jsx)(F,{children:(null===E||void 0===E?void 0:E.input)||"No input available"}),(0,N.jsx)(A.A,{}),(0,N.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:[(0,N.jsx)(D,{level:5,children:"System Response"}),(0,N.jsx)(d.A,{icon:(0,N.jsx)(b.A,{}),onClick:()=>W(null===E||void 0===E?void 0:E.output),size:"small",disabled:!(null!==E&&void 0!==E&&E.output),children:"Copy"})]}),(0,N.jsx)(F,{children:(null===E||void 0===E?void 0:E.output)||"No output available"})]})},"2"),(0,N.jsx)(R,{tab:"Detected Filters",children:null!==E&&void 0!==E&&E.filters_detected?(0,N.jsx)(M,{data:E.filters_detected}):(0,N.jsx)(c.A,{message:"No filters detected",type:"info"})},"3"),(0,N.jsx)(R,{tab:"Products",children:null!==E&&void 0!==E&&E.product_ids&&E.product_ids.length>0?(0,N.jsx)(f.Ay,{itemLayout:"horizontal",dataSource:E.product_ids,renderItem:e=>(0,N.jsx)(f.Ay.Item,{children:(0,N.jsx)(f.Ay.Item.Meta,{title:`Product ID: ${e||"Unknown"}`})})}):(0,N.jsx)(c.A,{message:"No products recommended",type:"info"})},"4"),(0,N.jsx)(R,{tab:"Metadata",children:null!==E&&void 0!==E&&E.metadata?(0,N.jsx)(M,{data:E.metadata}):(0,N.jsx)(c.A,{message:"No metadata available",type:"info"})},"5"),(0,N.jsx)(R,{tab:"Debug Info",children:null!==E&&void 0!==E&&E.debug_info?(0,N.jsx)(M,{data:E.debug_info}):(0,N.jsx)(c.A,{message:"No debug information available",type:"info"})},"6")]}):(0,N.jsx)(c.A,{message:"No log data available",type:"error"})})]})}},9251:(e,t,a)=>{a.d(t,{A:()=>o});var s=a(89379),r=a(9950);const l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880.1 154H143.9c-24.5 0-39.8 26.7-27.5 48L349 597.4V838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V597.4L907.7 202c12.2-21.3-3.1-48-27.6-48zM603.4 798H420.6V642h182.9v156zm9.6-236.6l-9.5 16.6h-183l-9.5-16.6L212.7 226h598.6L613 561.4z"}}]},name:"filter",theme:"outlined"};var i=a(25085),n=function(e,t){return r.createElement(i.A,(0,s.A)((0,s.A)({},e),{},{ref:t,icon:l}))};n.displayName="FilterOutlined";const o=r.forwardRef(n)}}]);